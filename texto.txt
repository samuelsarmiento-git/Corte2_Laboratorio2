Arquitectura y DiseÃ±o de Sistemas Distribuidos Seguros para la GestiÃ³n de Historias ClÃ­nicas ElectrÃ³nicas mediante Middleware y EstÃ¡ndares HL7
un sistema distribuido de historia clÃ­nica electrÃ³nica que integre una base de datos fragmentada con PostgreSQL + Citus, un middleware en Python (FastAPI) desplegado sobre Kubernetes (Minikube), cuatro interfaces grÃ¡ficas por rol, y una capa de seguridad OAuth2 con JWT que permita acceder al sistema desde cualquier dispositivo y exportar historias clÃ­nicas en PDF.


Objetivos EspecÃ­ficos
Desplegar un clÃºster distribuido de PostgreSQL + Citus en Kubernetes.
Implementar un middleware en Python (FastAPI) que gestione la comunicaciÃ³n con la base distribuida.
DiseÃ±ar cuatro interfaces grÃ¡ficas interactivas segÃºn el rol del usuario.
Integrar autenticaciÃ³n OAuth2 con JWT y autorizaciÃ³n por roles.
Habilitar la descarga segura de historias clÃ­nicas en PDF desde dispositivos externos.
Documentar todo el sistema con arquitectura, flujo de datos, decisiones tÃ©cnicas y pruebas.
Roles del equipo (en parejas)
Rol
Responsabilidades clave
ğŸ§  Backend & DevSecOps
- Configurar Citus en Minikube
- Crear el middleware y la API REST
- Implementar OAuth2 + JWT
- Contenerizar y desplegar la app en Kubernetes
ğŸ¨ Frontend & UX
- DiseÃ±ar las 4 interfaces HTML/Jinja2
- Integrar autenticaciÃ³n por rol en las vistas
- Crear flujo de usuario seguro
- Integrar descarga en PDF desde frontend Ambos deben participar en la documentaciÃ³n y sustentaciÃ³n tÃ©cnica.

Fase 1 â€“ : Infraestructura y Middleware Base (40%)
ğŸ“Œ Objetivo: Tener la base de datos distribuida operativa, el middleware conectado y un primer endpoint protegido.
Entregable
DescripciÃ³n
Peso
ValidaciÃ³n
ğŸ—„ï¸ Infraestructura Citus
Coordinador + 2 workers funcionando en Minikube con tabla distribuida por documento_id.
10%
kubectl get pods y SELECT * FROM usuario; funcional
ğŸ Middleware conectado
ConexiÃ³n desde FastAPI a Citus ejecutando consultas distribuidas.
10%
Endpoint /paciente/{id} funcionando
ğŸ³ Dockerfile y requirements
Imagen funcional con psycopg2, FastAPI y dependencias instaladas.
5%
Imagen middleware-citus:1.0 construida en Minikube
ğŸ” Seguridad base
Endpoint protegido con OAuth2 y generaciÃ³n de tokens JWT.
15%
Acceso solo con token a /paciente/{id}







Fase 2 â€“ : Interfaces, Seguridad Completa y ExportaciÃ³n (60%)
ğŸ“Œ Objetivo: Terminar el sistema con roles, autenticaciÃ³n completa, interfaces grÃ¡ficas y descarga segura desde cualquier dispositivo.
Entregable
DescripciÃ³n
Peso
ValidaciÃ³n
ğŸ§‘â€âš•ï¸ Interfaces completas
Cuatro vistas funcionales: paciente, admisionista, mÃ©dico y resultados.
15%
HTML/Jinja2 sirviendo desde FastAPI
ğŸ” AutenticaciÃ³n completa
OAuth2 + JWT con inicio de sesiÃ³n, registro y autorizaciÃ³n por rol.
15%
/login y /logout funcionales
ğŸ“± Acceso remoto seguro
Middleware accesible desde la red local y dispositivos mÃ³viles.
10%
Acceso desde celular o tablet en misma red
ğŸ“„ ExportaciÃ³n PDF segura
Descarga de historia clÃ­nica protegida por token JWT.
10%
Ruta /exportar_pdf/{id} protegida y funcional
ğŸ“˜ DocumentaciÃ³n tÃ©cnica
Diagrama de arquitectura, flujo de autenticaciÃ³n, decisiones de diseÃ±o y capturas.
10%
Documento entregado en .pdf o .docx

Requisitos tÃ©cnicos mÃ­nimos
Base de datos: PostgreSQL + Citus
Backend: Python + FastAPI
Seguridad: OAuth2 + JWT
Infraestructura: Kubernetes (Minikube)
Frontend: HTML + Jinja2
Contenedores: Docker
PDF: WeasyPrint
Control de versiones: Git / GitHub


Flujo de Seguridad â€“ OAuth2 + JWT
/login: Usuario se autentica â†’ recibe un JWT.
/paciente/{id}: Acceso permitido solo si se envÃ­a el token en el header.
/exportar_pdf/{id}: Ruta protegida; sin token no hay descarga.
Roles:
ğŸ©º MÃ©dico â†’ Puede registrar observaciones.
 Admisionista â†’ Gestiona ingresos.
Paciente â†’ Solo consulta.
Resultados â†’ Puede exportar en PDF.


Acceso desde red local (para celular o tablet)
Exponer el servicio FastAPI con un NodePort o Ingress.
Obtener la IP del clÃºster
Bonus opcional (+10%)
Implementar autenticaciÃ³n multifactor (MFA).
Integrar Keycloak u otro Identity Provider.
AÃ±adir logging de seguridad y auditorÃ­a de accesos.



Recomendaciones para los equipos
Dividan las tareas desde el dÃ­a 1 segÃºn los roles.
Documenten cada decisiÃ³n tÃ©cnica.
Hagan pruebas en local antes de desplegar en Kubernetes.
Validar la seguridad con herramientas como Postman o curl.
Suban el repositorio a GitHub con commits organizados por fases.
Entregables Finales
ğŸ“ CÃ³digo completo del proyecto.
ğŸ“¦ Imagen Docker funcional (middleware-citus:1.0).
â˜ï¸ Manifiestos Kubernetes (.yaml).
ğŸ§ª Capturas y pruebas desde dispositivo mÃ³vil.
